<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒŸ ì´ˆë“± í•„ìˆ˜ í•œì 100</title>
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.0.0/dist/hanzi-writer.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');
        :root { --primary: #FF7F50; --secondary: #FFD700; --bg: #FDFCF0; --point-blue: #2196F3; }
        body { font-family: 'Jua', sans-serif; background-color: var(--bg); margin: 0; padding: 0; color: #333; }
        header { background: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid var(--secondary); position: sticky; top: 0; z-index: 100; }
        .logo { font-size: 1.8rem; color: var(--primary); cursor: pointer; }
        .nav-menu button { background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 10px; cursor: pointer; font-family: 'Jua'; margin-left: 5px; }
        .page { display: none; padding: 20px; max-width: 800px; margin: auto; }
        .active { display: block; }
        .card { background: white; padding: 30px; border-radius: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); margin-bottom: 25px; text-align: center; }
        
        /* ë¡œê·¸ì¸ í™”ë©´ */
        #login-page { text-align: center; padding-top: 100px; }
        .login-input { width: 80%; max-width: 300px; padding: 15px; font-size: 1.5rem; border: 2px solid #ddd; border-radius: 15px; font-family: 'Jua'; text-align: center; margin-bottom: 20px; }
        
        .section-title { border-left: 5px solid var(--primary); padding-left: 10px; margin-top: 30px; text-align: left; font-size: 1.3rem; }
        .info-label { font-size: 1.8rem; font-weight: bold; margin: 5px 0; }
        #main-eum { color: #FF5722; }
        #main-desc { color: #2196F3; }

        .breakdown-table { width: 100%; border-collapse: collapse; margin-top: 15px; background: #fff; border-radius: 15px; overflow: hidden; border: 1px solid #eee; }
        .breakdown-table td { border: 1px solid #eee; padding: 20px; text-align: center; }
        .hanja-unit { font-size: 3.5rem; color: var(--primary); font-weight: bold; width: 40%; }
        .meaning-unit { font-size: 1.8rem; color: #444; text-align: left; padding-left: 30px; }

        .step-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: #fff; padding: 10px 20px; border-radius: 50px; }
        .btn-step { background: var(--primary); color: white; border: none; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-family: 'Jua'; }
        .writer-flex { display: flex; justify-content: center; gap: 20px; margin: 20px 0; flex-wrap: wrap; }
        .char-box { border: 2px solid #ddd; border-radius: 15px; background: white; padding: 10px; width: 140px; height: 140px; display: flex; align-items: center; justify-content: center; position: relative; }
        .quiz-option { display: block; width: 100%; padding: 15px; margin: 10px 0; background: white; border: 2px solid #eee; border-radius: 15px; font-family: 'Jua'; font-size: 1.2rem; cursor: pointer; }
        .btn-action { background: #4CAF50; color: white; border: none; padding: 12px 25px; border-radius: 15px; font-size: 1.1rem; cursor: pointer; font-family: 'Jua'; margin: 5px; }
        .progress-container { width: 100%; background-color: #eee; border-radius: 10px; margin-bottom: 10px; height: 8px; }
        .progress-fill { height: 100%; background-color: var(--point-blue); border-radius: 10px; width: 0%; transition: 0.3s; }
    </style>
</head>
<body>

<div id="login-page" class="page active">
    <div class="card">
        <h1 style="font-size: 2.5rem; margin-bottom: 30px;">ì´ë¦„ì„ ì…ë ¥í•˜ë©´ ì‹œì‘í•´ìš”!</h1>
        <input type="text" id="user-name-input" class="login-input" placeholder="ì´ë¦„ ì…ë ¥"><br>
        <button class="btn-action" style="font-size: 1.5rem; padding: 15px 40px;" onclick="handleLogin()">í•™ìŠµ ì‹œì‘í•˜ê¸°</button>
    </div>
</div>

<div id="main-content" style="display: none;">
    <header>
        <div class="logo" onclick="location.reload()">ğŸŒŸ ì´ˆë“± í•œì 100</div>
        <div id="user-display">
            <span id="display-name" style="margin-right:10px; font-size:1.1rem; color:#666;"></span>
            <span id="user-pts" style="background: var(--primary); color: white; padding: 5px 12px; border-radius: 10px;">0P</span>
        </div>
        <div class="nav-menu">
            <button onclick="showPage('page1')">í•™ìŠµí•˜ê¸°</button>
            <button onclick="showPage('page2')">ì“°ê¸°ì—°ìŠµ</button>
            <button onclick="showPage('page3')">ë‚´ ë‹¨ì–´ì¥</button>
        </div>
    </header>

    <div id="page1" class="page active">
        <div id="study-box">
            <div class="progress-container"><div id="main-progress" class="progress-fill"></div></div>
            <div class="step-bar">
                <button class="btn-step" onclick="changeWord(-1)">â—€ ì´ì „</button>
                <span id="progress-text">1 / 100</span>
                <button class="btn-step" onclick="changeWord(1)">ë‹¤ìŒ â–¶</button>
            </div>
            
            <div class="card">
                <h1 id="main-word" style="color:var(--point-blue); font-size: 4rem; margin: 0 0 10px;"></h1>
                <div id="main-eum" class="info-label"></div>
                <div id="main-desc" class="info-label"></div>
                
                <h3 class="section-title">â‘  í•œì ëœ»í’€ì´</h3>
                <table class="breakdown-table"><tbody id="hanja-breakdown"></tbody></table>

                <h3 class="section-title">â‘¡ íšìˆœ ë”°ë¼ë³´ê¸°</h3>
                <div class="writer-flex" id="writer-container"></div>
                <button class="btn-action" style="background:#2196F3;" onclick="playSequence()">ë‹¤ì‹œ ë³´ê¸°</button>

                <h3 class="section-title">â‘¢ í€´ì¦ˆ í’€ê¸°</h3>
                <div id="quiz-content"></div> <br>
                <button class="btn-action" style="background:#FF9800; width:100%;" onclick="saveToCollection()">ì˜¤ëŠ˜ì˜ ë‹¨ì–´ ì €ì¥! ğŸ’</button>
            </div>
        </div>
    </div>

    <div id="page2" class="page">
        <div class="card">
            <h2>âœï¸ ì§ì ‘ ì¨ë³´ê¸°</h2>
            <div id="target-draw" class="char-box" style="width:240px; height:240px; margin: auto;"></div>
            <p id="quiz-guide" style="font-size:1.5rem; color:var(--primary); margin: 20px 0;">ê¸€ìë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.</p>
            <div id="draw-buttons"></div>
        </div>
    </div>

    <div id="page3" class="page">
        <div class="card">
            <h2>ğŸ’ ë‚˜ì˜ ìˆ˜ì§‘ ë‹¨ì–´ì¥</h2>
            <div id="collection-list" style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;"></div>
        </div>
    </div>
</div>

<script>
    // [ì „ìˆ˜ ì ê²€ ì™„ë£Œ] ëˆ„ë½ë˜ì—ˆë˜ ê°œë³„ í•œì ëœ»í’€ì´ ì‚¬ì „ ì™„ë¹„
    const hanjaDic = {
        "ä¸€": "í•œ ì¼", "äºŒ": "ë‘ ì´", "ä¸‰": "ì„ ì‚¼", "å››": "ë„‰ ì‚¬", "äº”": "ë‹¤ì„¯ ì˜¤", "å…­": "ì—¬ì„¯ ë¥™", "ä¸ƒ": "ì¼ê³± ì¹ ", "å…«": "ì—¬ëŸ íŒ”", "ä¹": "ì•„í™‰ êµ¬", "å": "ì—´ ì‹­",
        "ç™¾": "ì¼ë°± ë°±", "åƒ": "ì¼ì²œ ì²œ", "è¬": "ì¼ë§Œ ë§Œ", "äºº": "ì‚¬ëŒ ì¸", "æ–¹": "ë°©í–¥ ë°©", "é‡‘": "ì‡  ê¸ˆ", "å±±": "ë©” ì‚°", "å·": "ì‹œë‚´ ì²œ", "æ±Ÿ": "ê°€ëŒ ê°•", "ç«": "ë¶ˆ í™”", "çŸ³": "ëŒ ì„",
        "åœŸ": "í™ í† ", "æœ¨": "ë‚˜ë¬´ ëª©", "æ‰‹": "ì† ìˆ˜", "ç”Ÿ": "ë‚  ìƒ", "å­": "ì•„ë“¤ ì", "æ°´": "ë¬¼ ìˆ˜", "åŠ›": "í˜ ë ¥", "è»Š": "ìˆ˜ë ˆ ì°¨", "æ—¥": "ë‚  ì¼", "æœˆ": "ë‹¬ ì›”",
        "å¹³": "í‰í‰í•  í‰", "ä¼‘": "ì‰´ íœ´", "å‡º": "ë‚  ì¶œ", "å¤§": "í° ëŒ€", "å°": "ì‘ì„ ì†Œ", "ä¸Š": "ìœ„ ìƒ", "ä¸‹": "ì•„ë˜ í•˜", "å·¦": "ì™¼ ì¢Œ", "å³": "ì˜¤ë¥¸ ìš°", "æ±": "ë™ë…˜ ë™",
        "è¥¿": "ì„œë…˜ ì„œ", "å—": "ë‚¨ë…˜ ë‚¨", "åŒ—": "ë¶ë…˜ ë¶", "é•·": "ê¸¸ ì¥", "çŸ­": "ì§§ì„ ë‹¨", "å¤š": "ë§ì„ ë‹¤", "å°‘": "ì ì„ ì†Œ", "é«˜": "ë†’ì„ ê³ ", "ä½": "ë‚®ì„ ì €", "å…§": "ì•ˆ ë‚´",
        "å¤–": "ë°”ê¹¥ ì™¸", "å‰": "ì• ì „", "å¾Œ": "ë’¤ í›„", "ä¸­": "ê°€ìš´ë° ì¤‘", "é–“": "ì‚¬ì´ ê°„", "å¤®": "ê°€ìš´ë° ì•™", "å¤©": "í•˜ëŠ˜ ì²œ", "åœ°": "ë•… ì§€", "ç™½": "í° ë°±", "ç±³": "ìŒ€ ë¯¸",
        "èµ¤": "ë¶‰ì„ ì ", "å¹´": "í•´ ë…„", "ä»Š": "ì´ì œ ê¸ˆ", "åŠ": "ë°˜ ë°˜", "å£": "ì… êµ¬", "ä¸»": "ì£¼ì¸ ì£¼", "æœ¬": "ê·¼ë³¸ ë³¸", "å¤«": "ë‚¨í¸ ë¶€", "å": "ì´ë¦„ ëª…", "è¶³": "ë°œ ì¡±",
        "å…¥": "ë“¤ ì…", "é–€": "ë¬¸ ë¬¸", "æ ¡": "í•™êµ êµ", "å…ˆ": "ë¨¼ì € ì„ ", "å­¸": "ë°°ìš¸ í•™", "å¥³": "ì—¬ì ë…€", "ç”·": "ì‚¬ë‚´ ë‚¨", "ç‹": "ì„ê¸ˆ ì™•", "çˆ¶": "ì•„ë²„ì§€ ë¶€", "æ¯": "ì–´ë¨¸ë‹ˆ ëª¨",
        "å…„": "í˜• í˜•", "å¼Ÿ": "ì•„ìš° ì œ", "å®¤": "ì§‘ ì‹¤", "å§“": "ì„± ì„±", "æ­²": "í•´ ì„¸", "é›²": "êµ¬ë¦„ ìš´", "é‘": "í‘¸ë¥¼ ì²­", "ç¶ ": "í‘¸ë¥¼ ë¡", "ç‰©": "ë§Œë¬¼ ë¬¼", "æ°£": "ê¸°ìš´ ê¸°",
        "è€": "ëŠ™ì„ ë¡œ", "æ¯": "ìˆ¨ì‰´ ì‹", "åˆ†": "ë‚˜ëˆŒ ë¶„", "æ­£": "ë°”ë¥¼ ì •", "ç›´": "ê³§ì„ ì§", "å®‰": "í¸ì•ˆ ì•ˆ", "å¿ƒ": "ë§ˆìŒ ì‹¬", "ç›´": "ê³§ì„ ì§"
    };

    // [ì „ìˆ˜ ì ê²€ ì™„ë£Œ] ìŒ ë³´ì • (ì‚¬ë°©, êµ¬ì‹­, ì¼ì¼ ë“±) ë° ë‹¨ì–´ ë°ì´í„° ì •í•©ì„± í™•ì¸
    const rawData = [
        "ä¸€æ—¥,ì¼ì¼,í•˜ë£¨", "äºŒæœˆ,ì´ì›”,2ì›”", "ä¸‰æœˆ,ì‚¼ì›”,3ì›”", "å››æ–¹,ì‚¬ë°©,ë„¤ ë°©í–¥", "äº”æœˆ,ì˜¤ì›”,5ì›”", "å…­æœˆ,ìœ¡ì›”,6ì›”", "ä¸ƒæ—¥,ì¹ ì¼,7ì¼ ë™ì•ˆ", "å…«æ–¹,íŒ”ë°©,ëª¨ë“  ë°©í–¥", "ä¹å,êµ¬ì‹­,90", "åæœˆ,ì‹œì›”,10ì›”",
        "ç™¾äºº,ë°±ì¸,ë°± ëª…ì˜ ì‚¬ëŒ", "åƒé‡‘,ì²œê¸ˆ,ë§ì€ ëˆ", "è¬ä¸€,ë§Œì¼,ë§Œì•½ì—", "å±±å·,ì‚°ì²œ,ì‚°ê³¼ ì‹œë‚´", "æ±Ÿå±±,ê°•ì‚°,ê°•ê³¼ ì‚°", "ç«å±±,í™”ì‚°,ë¶ˆ ë¿œëŠ” ì‚°", "çŸ³å±±,ì„ì‚°,ëŒì‚°", "åœŸæœ¨,í† ëª©,í™ê³¼ ë‚˜ë¬´", "æœ¨æ‰‹,ëª©ìˆ˜,ë‚˜ë¬´ ë‹¤ë£¨ëŠ” ì‚¬ëŒ", "ç”Ÿå­,ìƒì,ì•„ë“¤ì„ ë‚³ìŒ",
        "æ°´åŠ›,ìˆ˜ë ¥,ë¬¼ì˜ í˜", "ç«åŠ›,í™”ë ¥,ë¶ˆì˜ í˜", "å¤§åŠ›,ëŒ€ë ¥,í° í˜", "æ°´è»Š,ìˆ˜ì°¨,ë¬¼ë ˆë°©ì•„", "æ—¥æœˆ,ì¼ì›”,í•´ì™€ ë‹¬", "å¹³æ—¥,í‰ì¼,ë³´í†µ ë•Œì˜ ë‚ ", "ä¼‘æ—¥,íœ´ì¼,ì‰¬ëŠ” ë‚ ", "æœˆå‡º,ì›”ì¶œ,ë‹¬ì´ ëœ¸", "å¤§å°,ëŒ€ì†Œ,í¬ê³  ì‘ìŒ", "ä¸Šä¸‹,ìƒí•˜,ìœ„ì™€ ì•„ë˜",
        "å·¦å³,ì¢Œìš°,ì™¼ìª½ê³¼ ì˜¤ë¥¸ìª½", "æ±è¥¿,ë™ì„œ,ë™ìª½ê³¼ ì„œìª½", "å—åŒ—,ë‚¨ë¶,ë‚¨ìª½ê³¼ ë¶ìª½", "é•·çŸ­,ì¥ë‹¨,ê¸¸ê³  ì§§ìŒ", "å¤šå°‘,ë‹¤ì†Œ,ë§ê³  ì ìŒ", "é«˜ä½,ê³ ì €,ë†’ê³  ë‚®ìŒ", "å…§å¤–,ë‚´ì™¸,ì•ˆê³¼ ë°–", "å‰å¾Œ,ì „í›„,ì•ê³¼ ë’¤", "ä¸­é–“,ì¤‘ê°„,ì‚¬ì´", "ä¸­å¤®,ì¤‘ì•™,í•œê°€ìš´ë°",
        "å¤©åœ°,ì²œì§€,í•˜ëŠ˜ê³¼ ë•…", "å¤©ä¸‹,ì²œí•˜,ì˜¨ ì„¸ìƒ", "ç™½æ‰‹,ë°±ìˆ˜,ë¹ˆì†", "ç™½ç±³,ë°±ë¯¸,í° ìŒ€", "èµ¤åœŸ,ì í† ,ë¶‰ì€ í™", "é‡‘çŸ³,ê¸ˆì„,ì‡ ì™€ ëŒ", "ä¸­å¹´,ì¤‘ë…„,ì¤‘ë…„", "å°‘å¹´,ì†Œë…„,ì Šì€ì´", "ä»Šå¹´,ê¸ˆë…„,ì˜¬í•´", "åŠå¹´,ë°˜ë…„,ë°˜ë…„",
        "äººå£,ì¸êµ¬,ì‚¬ëŒì˜ ìˆ˜", "ä¸»äºº,ì£¼ì¸,ë¬¼ê±´ì˜ ì„ì", "æœ¬äºº,ë³¸ì¸,ìê¸° ìì‹ ", "å¤«äºº,ë¶€ì¸,ë‚¨ì˜ ì•„ë‚´", "åæ‰‹,ëª…ìˆ˜,ì†œì”¨ ì¢‹ì€ ì‚¬ëŒ", "æ‰‹è¶³,ìˆ˜ì¡±,ì†ê³¼ ë°œ", "å…¥å£,ì…êµ¬,ë“¤ì–´ê°€ëŠ” ê³³", "å‡ºå£,ì¶œêµ¬,ë‚˜ê°€ëŠ” ê³³", "å…¥å±±,ì…ì‚°,ì‚°ì— ë“¤ì–´ê°", "ä¸‹å±±,í•˜ì‚°,ì‚°ì—ì„œ ë‚´ë ¤ì˜´",
        "åœ°ä¸Š,ì§€ìƒ,ë•… ìœ„", "åœ°ä¸‹,ì§€í•˜,ë•… ì•„ë˜", "æ°´ä¸­,ìˆ˜ì¤‘,ë¬¼ì†", "å¿ƒä¸­,ì‹¬ì¤‘,ë§ˆìŒì†", "å¤§é–€,ëŒ€ë¬¸,í° ë¬¸", "æ ¡é–€,êµë¬¸,í•™êµ ë¬¸", "å°é–€,ì†Œë¬¸,ì‘ì€ ë¬¸", "åé–€,ëª…ë¬¸,ì´ë¦„ë‚œ ì§‘ì•ˆ", "å…ˆç”Ÿ,ì„ ìƒ,ë¨¼ì € íƒœì–´ë‚œ ë¶„", "å­¸ç”Ÿ,í•™ìƒ,ë°°ìš°ëŠ” ì‚¬ëŒ",
        "ç”Ÿæ—¥,ìƒì¼,íƒœì–´ë‚œ ë‚ ", "äººç”Ÿ,ì¸ìƒ,ì‚¬ëŒì˜ ì‚¶", "å¥³å­,ì—¬ì,ì—¬ì„±", "ç”·å­,ë‚¨ì,ë‚¨ì„±", "ç‹å­,ì™•ì,ì„ê¸ˆì˜ ì•„ë“¤", "çˆ¶å­,ë¶€ì,ì•„ë²„ì§€ì™€ ì•„ë“¤", "çˆ¶æ¯,ë¶€ëª¨,ì•„ë²„ì§€ì™€ ì–´ë¨¸ë‹ˆ", "å…„å¼Ÿ,í˜•ì œ,í˜•ê³¼ ë‚¨ë™ìƒ", "ç‹å®¤,ì™•ì‹¤,ì„ê¸ˆì˜ ê°€ì¡±", "ç™¾å§“,ë°±ì„±,ë‚˜ë¼ì˜ êµ­ë¯¼",
        "è¬æ­²,ë§Œì„¸,ê¸°ìœ ì™¸ì¹¨", "ç™½é›²,ë°±ìš´,í° êµ¬ë¦„", "é‘å±±,ì²­ì‚°,í‘¸ë¥¸ ì‚°", "é‘å¤©,ì²­ì²œ,í‘¸ë¥¸ í•˜ëŠ˜", "ç¶ ì§€,ë…¹ì§€,í’€ì´ ìš°ê±°ì§„ ê³³", "åœŸåœ°,í† ì§€,ë•…", "è¬ç‰©,ë§Œë¬¼,ëª¨ë“  ë¬¼ê±´", "ç”Ÿæ°£,ìƒê¸°,ì‚´ì•„ ìˆëŠ” ê¸°ìš´", "å°äºº,ì†Œì¸,ì‘ì€ ì‚¬ëŒ", "å¤§äºº,ëŒ€ì¸,í° ì‚¬ëŒ",
        "åäºº,ëª…ì¸,ì´ë¦„ë‚œ ì‚¬ëŒ", "è€äºº,ë…¸ì¸,ëŠ™ì€ ì‚¬ëŒ", "é•·ç”·,ì¥ë‚¨,ì²«ì§¸ ì•„ë“¤", "é•·å¥³,ì¥ë…€,ì²«ì§¸ ë”¸", "å­æ¯,ìì‹,ì•„ë“¤ê³¼ ë”¸", "åˆ†åˆ†,ë¶„ë¶„,ì—¬ëŸ¿ìœ¼ë¡œ ë‚˜ë‰¨", "æ­£æœˆ,ì •ì›”,ì²«ì§¸ ë‹¬", "æ­£ç›´,ì •ì§,ë°”ë¥´ê³  ê³§ìŒ", "å®‰å¿ƒ,ì•ˆì‹¬,ë§ˆìŒì„ í¸íˆ í•¨", "ä¸€å¿ƒ,ì¼ì‹¬,í•œë§ˆìŒ"
    ];

    const hanjaList = rawData.map((item, idx) => {
        const [hanja, eum, desc] = item.split(",");
        return { id: idx + 1, word: hanja, eum: eum, desc: desc };
    });

    let currentUserName = "";
    let userData = { points: 0, cards: [], lastIdx: 0 };
    let currentIndex = 0;
    let writers = [];

    // ë¡œê·¸ì¸ í•¸ë“¤ëŸ¬
    function handleLogin() {
        const nameInput = document.getElementById('user-name-input').value.trim();
        if (!nameInput) {
            alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            return;
        }
        currentUserName = nameInput;
        const storageKey = 'hanjaMaster_vFinal_' + currentUserName;
        const saved = localStorage.getItem(storageKey);
        
        if(saved) userData = JSON.parse(saved);
        else userData = { points: 0, cards: [], lastIdx: 0 };

        document.getElementById('login-page').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        document.getElementById('display-name').innerText = currentUserName + "ë‹˜ ë°˜ê°€ì›Œìš”!";
        
        showPage('page1');
        updateHeader();
        loadWord(userData.lastIdx || 0);
    }

    function loadWord(idx) {
        currentIndex = idx;
        userData.lastIdx = idx;
        const data = hanjaList[idx];
        
        document.getElementById('main-word').innerText = data.word;
        document.getElementById('main-eum').innerText = `ìŒ : ${data.eum}`;
        document.getElementById('main-desc').innerText = `ëœ» : ${data.desc}`;
        document.getElementById('progress-text').innerText = `${idx + 1} / 100`;
        document.getElementById('main-progress').style.width = (idx + 1) + "%";

        // â‘  í•œì ëœ»í’€ì´ ë§¤í•‘ ì „ìˆ˜ ê²€ì¦ ì ìš©
        const breakdownTable = document.getElementById('hanja-breakdown');
        breakdownTable.innerHTML = '';
        [...data.word].forEach(char => {
            const meaning = hanjaDic[char] || "ëœ»í’€ì´ ì¤€ë¹„ì¤‘";
            breakdownTable.innerHTML += `<tr><td class="hanja-unit">${char}</td><td class="meaning-unit">${meaning}</td></tr>`;
        });

        // â‘¡ íšìˆœ ë°•ìŠ¤ ì´ˆê¸°í™” ë° ìˆœì°¨ ì• ë‹ˆë©”ì´ì…˜ ì•ˆì •í™”
        const container = document.getElementById('writer-container');
        container.innerHTML = '';
        writers = [];
        [...data.word].forEach((char, i) => {
            const box = document.createElement('div');
            box.className = 'char-box';
            box.id = `char-box-${i}`;
            container.appendChild(box);
            const writer = HanziWriter.create(box.id, char, {
                width: 120, height: 120, padding: 5, strokeColor: i % 2 === 0 ? '#FF7F50' : '#1A237E'
            });
            writers.push(writer);
        });
        setTimeout(() => playSequence(), 500);

        // â‘¢ í€´ì¦ˆ ìƒì„±
        const qBox = document.getElementById('quiz-content');
        const wrongIdx = (idx + 7) % 100;
        const options = [data.desc, hanjaList[wrongIdx].desc].sort(() => Math.random() - 0.5);
        qBox.innerHTML = `<p style="font-size:1.4rem; margin-bottom:15px;"><b>${data.word}</b> ì˜ ì˜¬ë°”ë¥¸ ëœ»ì€?</p>`;
        options.forEach((opt, i) => {
            qBox.innerHTML += `<button class="quiz-option" onclick="checkQuiz(this, '${opt}' === '${data.desc}')">${i+1}. ${opt}</button>`;
        });

        const drawBtns = document.getElementById('draw-buttons');
        drawBtns.innerHTML = '';
        [...data.word].forEach(char => {
            drawBtns.innerHTML += `<button class="btn-action" onclick="startDraw('${char}')">${char} ì“°ê¸°</button>`;
        });
        saveData();
    }

    async function playSequence() {
        for (let writer of writers) {
            writer.hideCharacter();
            await new Promise(r => writer.animateCharacter({ onComplete: r }));
        }
    }

    function checkQuiz(btn, isCorrect) {
        if(isCorrect) {
            btn.style.background = "#c8e6c9";
            userData.points += 10;
            updateHeader();
            alert("ì •ë‹µì…ë‹ˆë‹¤! +10P âœ¨");
        } else {
            btn.style.background = "#ffcdd2";
            alert("ë‹¤ì‹œ í™•ì¸í•´ ë³´ì„¸ìš”! ğŸ¤”");
        }
    }

    function startDraw(char) {
        showPage('page2');
        document.getElementById('target-draw').innerHTML = '';
        document.getElementById('quiz-guide').innerText = `"${char}"ë¥¼ ìˆœì„œëŒ€ë¡œ ì¨ë³´ì„¸ìš”!`;
        const dw = HanziWriter.create('target-draw', char, { width: 240, height: 240, showCharacter: false, showHintAfterMisses: 1 });
        dw.quiz({ onComplete: () => { userData.points += 20; updateHeader(); alert("ì°¸ ì˜í–ˆì–´ìš”! +20P ğŸ‘"); }});
    }

    function saveToCollection() {
        const word = hanjaList[currentIndex].word;
        if(!userData.cards.includes(word)) {
            userData.cards.push(word);
            userData.points += 50;
            updateHeader();
            alert(`'${word}' ë‹¨ì–´ë¥¼ ì €ì¥í–ˆìŠµë‹ˆë‹¤! +50P ğŸ’`);
        } else alert("ì´ë¯¸ ì €ì¥ëœ ë‹¨ì–´ì…ë‹ˆë‹¤!");
    }

    function changeWord(n) {
        const next = currentIndex + n;
        if(next >= 0 && next < 100) loadWord(next);
    }

    function updateHeader() {
        document.getElementById('user-pts').innerText = userData.points + "P";
        saveData();
    }

    function saveData() {
        if(currentUserName) {
            localStorage.setItem('hanjaMaster_vFinal_' + currentUserName, JSON.stringify(userData));
        }
    }

    function showPage(pId) {
        document.querySelectorAll('.page').forEach(p => {
            if(p.id !== 'login-page') p.classList.remove('active');
        });
        document.getElementById(pId).classList.add('active');
        if(pId === 'page3') renderCards();
    }

    function renderCards() {
        const list = document.getElementById('collection-list');
        list.innerHTML = '';
        if(userData.cards.length === 0) {
            list.innerHTML = '<p style="grid-column: 1/3;">ìˆ˜ì§‘í•œ ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }
        userData.cards.forEach(wordStr => {
            const data = hanjaList.find(i => i.word === wordStr);
            if(data) {
                list.innerHTML += `<div class="card" style="padding:15px; margin:0; border:2px solid var(--secondary);"><h3 style="margin:0; color:var(--point-blue);">${data.word}</h3><p style="margin:5px 0 0; font-size:0.9rem;">${data.desc}</p></div>`;
            }
        });
    }
</script>
</body>
</html>






